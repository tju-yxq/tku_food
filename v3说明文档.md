好的，遵照你的要求，并且基于我们最终确定的**“管理员-角色一对多”**的简化设计，我对 `v3说明文档.md` 进行了彻底的重写和补充。

这份 **v3.1 版本**的说明文档，现在与你最终的 `v3.sql` 脚本完全对应，并包含了所有模块和表的详细分析。

------

# TjuFood - 数据库设计说明书 (v3.1)

[TOC]

## 1. 设计概述

### 1.1 设计目标

本数据库旨在为“TjuFood 天津大学美食指南”项目提供一个结构清晰、性能高效、易于扩展的数据存储方案。设计遵循以下核心目标：

- **数据完整性**: 通过主键、外键、唯一约束和非空约束，确保数据的准确性和一致性。
- **查询性能**: 针对高频查询场景，设计合理的索引策略，优化数据检索速度。
- **业务解耦**: 通过模块化的表设计，将用户、内容、运营、系统等不同业务领域的数据进行有效隔离，便于独立维护和扩展。
- **可扩展性**: 采用混合主键生成策略，为未来可能的分布式部署和业务增长预留空间。

### 1.2 命名规范

- 所有表名均采用`tb_`前缀，例如 `tb_user`。
- 表名和字段名均使用小写字母和下划线`_`分隔。
- 索引名采用`idx_`或`uq_`前缀，并清晰地描述其作用的表和字段。

### 1.3 主键策略

本项目采用**混合主键（PK）生成策略**：

1. **程序生成 (BIGINT)**: 针对用户生成内容（UGC）和核心动态业务实体，如`tb_user`, `tb_blog`, `tb_comment`等。这种方式有利于应用层的控制，并在未来分布式环境下避免ID冲突。
2. **数据库自增 (BIGINT IDENTITY)**: 针对相对静态、由管理员维护的基础数据和关联表，如`tb_canteen`, `tb_role`等。这种方式简化了基础数据的录入操作。

------

## 2. 模块化表结构详解

### 模块 1: 用户与权限 (User & Permissions)

本模块负责管理系统的所有参与者（普通用户和管理员）及其权限体系，是整个系统安全的基础。

| **表名**             | **实体**       | **主键策略** | **核心功能描述**                                             |
| -------------------- | -------------- | ------------ | ------------------------------------------------------------ |
| `tb_user`            | User           | 程序生成     | 存储所有注册用户的核心信息，如邮箱、加密密码、昵称、积分等。 |
| `tb_admin`           | Admin          | 数据库自增   | 存储后台管理员的登录账号、密码及状态，并直接关联一个角色。   |
| `tb_role`            | Role           | 数据库自增   | 定义后台角色，如“内容管理员”、“社区管理员”。                 |
| `tb_permission`      | Permission     | 数据库自增   | 定义原子化的操作权限点，如`content:dish:create`（创建菜品）。 |
| `tb_role_permission` | RolePermission | 数据库自增   | **关联表**，建立`role`与`permission`之间的多对多关系，实现RBAC权限模型。 |

#### 关系模型分析:

- **管理员-角色**: **一对多**。一个管理员（`tb_admin`）通过`role_id`字段直接关联到一个角色（`tb_role`）。
- **角色-权限**: **多对多**。通过中间表`tb_role_permission`实现。

------

### 模块 2: 核心基础数据 (Core Data)

本模块构成了平台的“信息库”，存储了所有关于餐饮服务的静态或半静态数据，由`内容管理员`在后台维护。

| **表名**          | **实体**    | **主键策略** | **核心功能描述**                             |
| ----------------- | ----------- | ------------ | -------------------------------------------- |
| `tb_campus`       | Campus      | 数据库自增   | 校区信息表，如“卫津路校区”。                 |
| `tb_canteen_type` | CanteenType | 数据库自增   | 食堂类型表，如“学生食堂”、“教工食堂”。       |
| `tb_canteen`      | Canteen     | 数据库自增   | 食堂详情表，包含地址、营业时间、综合评分等。 |
| `tb_stall_type`   | StallType   | 数据库自增   | 窗口类型表，如“面食”、“麻辣香锅”。           |
| `tb_stall`        | Stall       | 数据库自增   | 窗口详情表，隶属于特定食堂。                 |
| `tb_dish`         | Dish        | 数据库自增   | 菜品详情表，隶属于特定窗口。                 |

#### 关系模型分析:

- 这是一个清晰的**一对多层级关系**: `tb_campus` -> `tb_canteen` -> `tb_stall` -> `tb_dish`。
- `tb_canteen`和`tb_stall`分别有自己的分类表`tb_canteen_type`和`tb_stall_type`，也是一对多关系。

------

### 模块 3: 内容与互动 (Content & Interaction)

本模块是社区生态的核心，记录了所有由用户生成的内容（UGC）以及用户之间的互动行为。所有主键均由程序生成。

| **表名**            | **实体**      | **主键策略** | **核心功能描述**                                   |
| ------------------- | ------------- | ------------ | -------------------------------------------------- |
| `tb_blog`           | Blog          | 程序生成     | 用户发布的博客/笔记，是深度内容的主要载体。        |
| `tb_stall_review`   | StallReview   | 程序生成     | 用户对**窗口**的图文评价和多维度评分。             |
| `tb_comment`        | Comment       | 程序生成     | 对博客或评论的回复，支持楼中楼。                   |
| `tb_like`           | Like          | 程序生成     | **行为表**，记录用户对博客、评论、菜品的点赞行为。 |
| `tb_favorite`       | Favorite      | 程序生成     | **行为表**，记录用户对博客、窗口的收藏行为。       |
| `tb_search_history` | SearchHistory | 程序生成     | 记录用户搜索关键词，可用于搜索推荐。               |
| `tb_report`         | Report        | 程序生成     | 记录用户对违规内容的举报。                         |
| `tb_notification`   | Notification  | 程序生成     | 存储发送给用户的站内信（点赞、评论通知等）。       |

#### 关系模型分析:

- `tb_user` 与 `tb_blog`, `tb_stall_review`, `tb_comment` 等UGC表是**一对多**关系。
- `tb_like` 和 `tb_favorite` 是典型的多对多关系实现，通过`type`字段区分关联的不同类型的实体。

------

### 模块 4: 用户激励 (User Engagement)

本模块定义了用于提升用户活跃度和粘性的相关功能。

| **表名**            | **实体**      | **主键策略** | **核心功能描述**                                           |
| ------------------- | ------------- | ------------ | ---------------------------------------------------------- |
| `tb_credit_record`  | CreditRecord  | 程序生成     | **流水表**，详细记录用户积分的每一次增减。                 |
| `tb_sign`           | Sign          | 程序生成     | 记录用户每日签到行为，`user_id`和`date`有联合唯一约束。    |
| `tb_voucher`        | Voucher       | 程序生成     | **优惠券模板表**，定义了优惠券的面额、规则、库存等。       |
| `tb_user_voucher`   | UserVoucher   | 程序生成     | **用户券包**，记录用户实际拥有的优惠券实例及其使用状态。   |
| `tb_incentive_rule` | IncentiveRule | 数据库自增   | **规则配置表**，用于后台动态配置各种用户行为的积分奖励值。 |

#### 关系模型分析:

- `tb_user` 与 `tb_credit_record`, `tb_sign`, `tb_user_voucher` 是**一对多**关系。
- `tb_user_voucher` 与 `tb_voucher` 是**多对一**关系（多个券实例可以来自同一个模板）。

------

### 模块 5: 系统管理与展示 (System & Display)

本模块包含系统运营、管理和公共服务所需的各项功能。

| **表名**            | **实体**      | **主键策略** | **核心功能描述**                                           |
| ------------------- | ------------- | ------------ | ---------------------------------------------------------- |
| `tb_banner`         | Banner        | 数据库自增   | 运营人员用于配置首页等位置的轮播图。                       |
| `tb_notice`         | Notice        | 数据库自增   | 运营人员用于发布全站公告。                                 |
| `tb_log`            | Log           | 程序生成     | **日志表**，用于记录管理员在后台的关键操作，便于审计追溯。 |
| `tb_file`           | File          | 程序生成     | **公共文件表**，统一管理用户上传的所有文件资源。           |
| `tb_sensitive_word` | SensitiveWord | 程序生成     | 敏感词库，用于UGC内容的自动过滤。                          |
| `tb_help_doc`       | HelpDoc       | 数据库自增   | 后台使用的在线帮助文档。                                   |
| `tb_system_config`  | SystemConfig  | 程序生成     | 系统级参数配置表，用于动态调整系统行为。                   |
| `tb_user_feedback`  | UserFeedback  | 程序生成     | 收集和管理用户的意见反馈。                                 |

#### 关系模型分析:

- 这些表大多是独立的功能实体，由管理员（`tb_admin`）创建和管理，例如`tb_notice`中的`admin_id`外键。

------

### 模块 6: 统计与分析 (Statistics & Analysis)

本模块用于存储预计算的统计和分析结果，为数据可视化和运营决策提供支持。

| **表名**            | **实体**      | **主键策略** | **核心功能描述**                                             |
| ------------------- | ------------- | ------------ | ------------------------------------------------------------ |
| `tb_ranking`        | Ranking       | 程序生成     | **结果表**，存储各类排行榜数据，如菜品热度榜、用户积分榜。   |
| `tb_statistics`     | Statistics    | 程序生成     | **结果表**，存储各类统计数据，如用户日活、食堂评分分布等。   |
| `tb_scheduled_task` | ScheduledTask | 数据库自增   | **配置表**，管理系统后台的定时任务，如数据聚合、榜单计算等。 |

#### 关系模型分析:

- 这些表是**数据仓库**的角色，它们的数据来源于对其他业务表（如`tb_user`, `tb_blog`）的定时分析和计算，自身不建立直接的外键关联。
