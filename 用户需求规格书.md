# 📝 TjuFood 天津大学美食点评平台- 用户需求规格书

## 1. 引言

### 1.1 文档目的

本文档是“TjuFood 天津大学美食点评平台”项目的核心技术与需求规约，旨在作为项目开发、测试、运维及未来迭代的最高指导文件。它详细阐述了项目目标、系统角色、功能范围、业务流程，并固化了经过评审和重构后的关键技术选型与架构决策。

### 1.2 系统概述

“TjuFood”是一个旨在为天津大学全体师生提供一站式校园餐饮信息服务的平台。系统以详尽的食堂、窗口、菜品数据为基础，通过用户生成内容（UGC）建立一个活跃的美食分享社区，并结合用户激励体系提升用户粘性。同时，系统将为管理者提供强大的后台功能，通过数据驱动决策，持续优化餐饮服务质量。

## 2. 非功能性需求 (质量属性)

本章节定义了项目的技术架构选型与系统质量属性，是指导技术实现的核心规约。

| 类别                             | 需求描述                                                     | 规划实现策略                                                 |
| -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **高安全性 (Security)**          | 1. 用户密码必须经过加盐和安全的哈希算法加密后存储。 2. 核心API接口必须进行严格的认证和授权校验。 3. 需有效防范常见的Web安全漏洞，如SQL注入、XSS攻击。 | 1. 后端采用 **BCrypt** 算法对所有密码进行加盐哈希 [cite: back/pom.xml]。 2. 设计并实现基于**无状态Token**的认证机制，通过自定义**拦截器(Interceptor)**对受保护的API进行精确的访问控制 [cite: back/src/main/java/xyz/tjucomments/tjufood/config/MvcConfig.java]。 3. 全面采用 **MyBatis-Plus** 框架防止SQL注入；对用户输入内容进行必要的后端过滤或前端转义以防范XSS [cite: back/pom.xml]。 |
| **高性能 (Performance)**         | 1. 核心API接口的平均响应时间应控制在200毫秒以内。 2. 高频访问的热点数据（如食堂列表、菜品详情）应最大限度地减少数据库直接访问。 | 1. 对所有数据库查询的`WHERE`条件及外键关联字段**建立索引** [cite: v3.sql]。 2. 引入 **Redis** 作为核心缓存层，并使用封装的`CacheClient`工具类，通过**缓存空对象**和**逻辑过期**策略有效解决缓存穿透和击穿问题 [cite: back/src/main/java/xyz/tjucomments/tjufood/utils/cache/CacheClient.java]。 |
| **高可用性 (Availability)**      | 1. 系统应能捕获并优雅地处理所有运行时异常，避免因单点故障导致服务中断。 2. 核心业务流程（如用户注册）应具备容错能力，不因非关键性输入缺失而失败。 | 1. 后端设置**全局异常处理器** (`GlobalExceptionHandler`)，统一拦截并处理异常，向客户端返回标准化的错误信息 [cite: back/src/main/java/xyz/tjucomments/tjufood/config/advice/GlobalExceptionHandler.java]。 2. 对API的DTO参数使用`@Validated`注解进行服务端校验 [cite: back/src/main/java/xyz/tjucomments/tjufood/dto/AdminLoginDTO.java]。在用户注册等关键服务中，对非必要字段（如昵称）提供**默认值生成逻辑**，保证核心功能不受影响。 |
| **高可扩展性 (Scalability)**     | 1. 系统架构需支持未来业务增长带来的流量提升，能够平滑地进行水平扩展。 2. 主键生成策略需支持未来的分布式部署。 | 1. 后端服务设计为**无状态**，通过将Session（Token）信息存储在外部Redis中，使得应用实例可以被轻松地水平扩展和负载均衡 [cite: back/src/main/java/xyz/tjucomments/tjufood/interceptor/RefreshTokenInterceptor.java]。 2. 采用混合主键生成策略：所有用户生成内容（UGC）及核心业务实体的主键，均由基于Redis的**分布式ID生成器** (`RedisIdWorker`)生成，为分布式数据库架构打下基础 [cite: back/src/main/java/xyz/tjucomments/tjufood/utils/id/RedisIdWorker.java]。 |
| **高可维护性 (Maintainability)** | 1. 代码结构清晰，遵循业界公认的设计原则，降低长期维护成本。 2. 关键配置和业务规则应易于修改，避免硬编码。 | 1. 严格遵循`Controller-Service-Mapper`三层架构，并采用**组合优于继承**的原则设计DTO，实现各层解耦 [cite: back/src/main/java/xyz/tjucomments/tjufood/dto/CanteenDTO.java]。 2. 将所有“魔术值”（如Redis Key前缀、业务状态码、默认密码）**常量化**，在独立的常量包中进行统一管理。 3. 引入**AOP切面**，以非侵入的方式实现统一的日志记录。 |
| **可观测性 (Observability)**     | 系统需提供足够的监控能力，以便快速定位问题和分析性能瓶颈。   | 1. 通过AOP实现**结构化操作日志**，记录每次API调用的操作人、IP、请求参数、响应结果和耗时。 2. 集成 **Spring Boot Actuator** 端点，暴露应用健康状况、Metrics等核心监控指标 [cite: back/pom.xml]。 |

## 3. 系统角色与权限

### 3.1 角色定义

- **anonymous**（游客）：可以浏览公开信息，如食堂、菜品、公开的评价等。
- **user**（注册用户）：系统的核心参与者，可以进行评价、发布博客、评论、点赞、收藏等所有社区互动。
- **admin**（后台管理员）：一个统称，根据职责细分为以下角色：
  - **内容管理员**：负责管理食堂、窗口、菜品等核心基础数据。
  - **社区管理员**：负责审核用户内容、处理举报、管理用户和敏感词。
  - **运营管理员**：负责平台运营活动，如轮播图、公告、优惠券等。
- **boss**（平台所有者）：拥有系统最高权限，负责管理所有管理员账号、角色权限、系统核心配置及数据分析。

### 3.2 角色功能权限矩阵

| 功能模块       | 功能描述                 | anonymous | user  | admin   | boss    |
| -------------- | ------------------------ | --------- | ----- | ------- | ------- |
| **账号与认证** | 注册新账号               | ✅         | ❌     | ❌       | ❌       |
|                | 账号密码登录             | ❌         | ✅     | ✅       | ✅       |
|                | 修改个人密码 (需原密码)  | ❌         | ✅     | ✅       | ✅       |
|                | **通过验证码找回密码**   | ❌         | **✅** | ❌       | ❌       |
|                | 管理个人信息             | ❌         | ✅     | ❌       | ✅(所有) |
| **基础浏览**   | 浏览食堂/窗口/菜品等     | ✅         | ✅     | ✅       | ✅       |
|                | 查看公开的评价/博客/评论 | ✅         | ✅     | ✅       | ✅       |
| **社区互动**   | 提交窗口评价/评分        | ❌         | ✅     | ❌       | ❌       |
|                | 发布/编辑/删除自己的博客 | ❌         | ✅     | ❌       | ✅(所有) |
|                | 发表/删除自己的评论      | ❌         | ✅     | ❌       | ✅(所有) |
|                | 点赞/收藏                | ❌         | ✅     | ❌       | ❌       |
| **后台管理**   | **创建/管理Admin账号**   | ❌         | ❌     | ❌       | **✅**   |
|                | **管理角色与权限**       | ❌         | ❌     | ❌       | **✅**   |
|                | 内容审核/管理            | ❌         | ❌     | ✅(分配) | ✅       |
|                | 基础数据管理             | ❌         | ❌     | ✅(分配) | ✅       |
|                | 平台运营管理             | ❌         | ❌     | ✅(分配) | ✅       |

## 4. 系统功能需求详解 (按优先级划分)

### 4.1 A级功能 (核心功能 - 必须实现)

此级别的功能构成了TjuFood平台的核心价值，是项目第一阶段必须完成的目标。

- **A-1: 账号认证体系 (`UserController`, `AdminController`)**
  - **用户注册与登录**: 提供基于邮箱+密码的基础注册和登录流程，是用户进入系统的唯一入口。
  - **管理员登录**: 提供独立的后台登录接口，保障后台系统的访问安全。
  - **Token认证机制**: 实现基于Token的无状态认证，支撑整个系统的API安全。
- **A-2: 核心餐饮数据浏览 (`CanteenController`, `StallController`, `DishController`)**
  - **信息展示**: 用户（包括游客）能够按层级（校区->食堂->窗口->菜品）浏览所有餐饮基础信息。这是平台信息服务的基础。
- **A-3: 核心UGC - 窗口评价 (`StallReviewController` - 需新建)**
  - **评价与评分**: 注册用户可以对**窗口**进行图文评价，并给出1-5星的总体评分。这是平台社区价值的起点。
- **A-4: 后台基础管理**
  - **餐饮数据管理**: `内容管理员`必须能够对校区、食堂、窗口、菜品进行完整的CRUD操作，确保线上数据源的准确性。
  - **内容审核**: `社区管理员`必须能够审核用户提交的窗口评价，保证社区内容的质量。

### 4.2 B级功能 (完善体验 - 建议实现)

此级别的功能旨在丰富社区生态，提升用户体验和粘性，是项目发展壮大的关键。

- **B-1: 社区功能扩展**
  - **博客系统**: 允许用户发布更丰富、更有深度的图文美食攻略（博客/笔记）。
  - **评论与互动**: 开放对博客、评价的评论功能，并提供点赞、收藏等轻量级互动，构建社区氛围。
  - **用户管理**: `社区管理员`能够管理用户信息，如禁用违规用户。
- **B-2: 运营与激励体系**
  - **积分系统**: 建立用户行为激励模型，通过签到、发布内容等方式奖励积分，并记录积分流水。
  - **运营工具**: 提供公告、首页轮播图等后台管理功能，便于平台活动推广。
  - **安全与合规**: `社区管理员`能够管理敏感词库，对用户发布内容进行自动过滤。
- **B-3: 用户体验优化**
  - **个人中心**: 用户可以查看和编辑自己的个人资料、发布过的内容、收藏和点赞记录。
  - **消息通知**: 建立站内信系统，当用户的内容被回复或点赞时，发送实时通知。
  - **验证码找回密码**: 为普通用户提供通过邮箱验证码找回密码的功能，提升账户安全性。

### 4.3 C级功能 (创新与未来 - 可选实现)

此级别的功能是平台的长期目标，旨在通过数据和智能技术，打造差异化优势，提供更深层次的服务。

- **C-1: 智能服务 - AI本地知识库问答**
  - **目标**: 引入大语言模型（LLM），结合平台内真实、丰富的餐饮数据，为用户提供智能问答服务。
  - **场景**: 用户可以提出“学三食堂有什么不辣的推荐菜？”、“求推荐卫津路校区性价比最高的午餐”等自然语言问题。
  - **技术规划**: 后端构建一个**AI服务层**，负责整合系统内的本地知识（如菜品标签、高赞评价、价格范围等），将其作为上下文（Context）与用户的问题一同提交给大语言模型（LLM）。
  - **技术**: 通过`RestTemplate`或`WebClient`调用外部LLM的API接口，对返回结果进行处理后呈现给用户。
- **C-2: 个性化推荐**
  - **目标**: 基于用户的历史行为（浏览、搜索、点赞、收藏），为其构建用户画像，并推荐可能感兴趣的菜品、窗口或美食博客。
  - **技术规划**: **初期可采用协同过滤或基于内容的推荐等简单算法，后期可逐步过渡到更复杂的机器学习模型。**
- **C-3: 数据分析与洞察**
  - **目标**: 将平台积累的用户行为和评价数据进行深度分析，形成数据报告。
  - **场景**: 为学校后勤管理部门提供各食堂、窗口的评分趋势、热门/冷门菜品分析、用户意见汇总等，为餐饮服务的优化提供数据支持。